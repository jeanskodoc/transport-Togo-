<!DOCTYPE html>
<html lang="fr">
     <style>
  .btn-retour {
    padding: 8px 16px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  }
  .btn-retour:hover {
    background-color: #e0e0e0;
  }
</style>
     <button class="btn-retour" onclick="history.back()">‚Üê Retour</button>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxiTogo - Connexion Conducteur</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 400px;
        }
        
        .login-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .login-header {
            background: var(--primary);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .logo {
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
        
        .logo-icon {
            margin-right: 10px;
            font-size: 2.5rem;
        }
        
        .login-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .login-body {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-group input:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #7f8c8d;
            cursor: pointer;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .login-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
        }
        
        .login-footer a {
            color: var(--secondary);
            text-decoration: none;
        }
        
        .login-footer a:hover {
            text-decoration: underline;
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .alert-error {
            background: #fee;
            color: #c33;
            border: 1px solid #fcc;
        }
        
        .alert-success {
            background: #efe;
            color: #363;
            border: 1px solid #cfc;
        }
        
        .hidden {
            display: none;
        }
        
        /* Styles pour l'application principale */
        .app-container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 90vh;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .driver-info {
            text-align: right;
        }
        
        .driver-name {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 15px;
        }
        
        .setup-form, .trip-card, .tracking-section, .payment-section, .receipts-section, .history-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 20px;
            margin: 20px;
        }
        
        .section-title {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .info-card {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        
        .btn-app {
            display: inline-block;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            flex: 1;
        }
        
        .btn-primary-app {
            background: var(--secondary);
            color: white;
        }
        
        .btn-success-app {
            background: var(--success);
            color: white;
        }
        
        .btn-warning-app {
            background: var(--warning);
            color: white;
        }
        
        .btn-accent-app {
            background: var(--accent);
            color: white;
        }
        
        .btn-whatsapp-app {
            background: #25D366;
            color: white;
        }
        
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .receipt {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px dashed #dee2e6;
        }
        
        .receipt-title {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .receipt-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .receipt-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .receipt-total {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--success);
            border-top: 2px solid #dee2e6;
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .filter-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .receipts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .receipt-card {
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid var(--secondary);
        }
        
        .receipt-card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .receipt-card-date {
            font-weight: 600;
            color: var(--primary);
        }
        
        .receipt-card-amount {
            font-weight: 700;
            color: var(--success);
        }
        
        .receipt-card-details {
            font-size: 0.9rem;
            color: #666;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-time {
            font-weight: 600;
            color: var(--primary);
        }
        
        .history-action {
            color: #666;
        }
        
        .trip-header {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .trip-title {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .trip-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .status-active {
            background: var(--success);
        }
        
        .status-paused {
            background: var(--warning);
        }
        
        .status-finished {
            background: var(--accent);
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
        }
        
        .info-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .info-label {
            font-weight: 600;
            color: #555;
        }
        
        .info-value {
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .map-integration {
            background: #e8f4fd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid var(--secondary);
        }
        
        .map-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .map-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            background: var(--secondary);
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .map-btn:hover {
            background: #2980b9;
        }
        
        .map-btn-whatsapp {
            background: #25D366;
        }
        
        .map-btn-whatsapp:hover {
            background: #128C7E;
        }
        
        .gps-status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }
        
        .gps-active {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .gps-inactive {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .gps-waiting {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .driver-info {
                text-align: center;
                margin-top: 10px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .map-buttons {
                flex-direction: column;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .receipts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
    
<body>
    <!-- √âcran de connexion -->
    <div class="container" id="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="logo">
                    <span class="logo-icon">üöï</span>
                    <span>TaxiTogo</span>
                </div>
                <div class="login-subtitle">Espace Conducteur</div>
            </div>
            <div class="login-body">
                <div id="login-alert" class="alert alert-error hidden"></div>
                
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-identifiant"><i class="fas fa-user"></i> Identifiant</label>
                        <input type="text" id="login-identifiant" placeholder="Votre identifiant" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="login-password"><i class="fas fa-lock"></i> Mot de passe</label>
                        <div class="password-container">
                            <input type="password" id="login-password" placeholder="Votre mot de passe" required>
                            <button type="button" class="toggle-password" id="toggle-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Se connecter
                    </button>
                </form>
                
                <div class="login-footer">
                    <p>Probl√®me de connexion ? <a href="#" id="forgot-password">Contactez l'administrateur</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Application principale (cach√©e au d√©part) -->
    <div class="app-container hidden" id="app-container">
        <div class="app-header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">üöï</span>
                    <span>TaxiTogo</span>
                </div>
                <div class="driver-info">
                    <div class="driver-name" id="driver-name-display">Koffi Mensah</div>
                    <div id="driver-service-display">Taxi Moto ‚Ä¢ Lom√©, Togo</div>
                    <button class="logout-btn" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> D√©connexion
                    </button>
                </div>
            </div>
        </div>
        
        <div class="setup-form" id="setup-form">
            <h2 class="section-title"><i class="fas fa-cog"></i> Configuration du trajet</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="driver-name">Nom du chauffeur</label>
                    <input type="text" id="driver-name" value="Koffi Mensah" readonly>
                </div>
                <div class="form-group">
                    <label for="service-type">Type de service</label>
                    <select id="service-type">
                        <option value="moto">Moto Taxi</option>
                        <option value="tricycle">Tricycle</option>
                        <option value="bagage">Taxi Bagage</option>
                        <option value="commun">Transport Commun</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="price-per-km">Prix par km (FCFA)</label>
                    <input type="number" id="price-per-km" value="150" min="1">
                </div>
                <div class="form-group">
                    <label for="extra-fees-input">Frais suppl√©mentaires (FCFA)</label>
                    <input type="number" id="extra-fees-input" value="200" min="0">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="client-name">Nom du client</label>
                    <input type="text" id="client-name" placeholder="Entrez le nom du client">
                </div>
                <div class="form-group">
                    <label for="client-phone">T√©l√©phone du client</label>
                    <input type="text" id="client-phone" placeholder="+22890123456">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="start-address">Votre position actuelle</label>
                    <input type="text" id="start-address" value="Position GPS" readonly>
                </div>
                <div class="form-group">
                    <label for="end-address">Adresse de destination</label>
                    <input type="text" id="end-address" placeholder="Universit√© de Lom√©, Lom√©, Togo">
                </div>
            </div>
            
            <div class="controls">
                <button class="btn-app btn-primary-app" id="start-trip-btn">
                    <i class="fas fa-play"></i> D√©marrer avec Google Maps
                </button>
            </div>
        </div>
        
        <div class="trip-card hidden" id="trip-card">
            <div class="trip-header">
                <div class="trip-title">Trajet en cours avec Google Maps</div>
                <div class="trip-status status-active" id="trip-status">ACTIF</div>
            </div>
            <div class="trip-body">
                <div class="info-grid">
                    <div class="info-card">
                        <h3><i class="fas fa-user"></i> Informations client</h3>
                        <div class="info-item">
                            <span class="info-label">Nom:</span>
                            <span class="info-value" id="client-name-display">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">T√©l√©phone:</span>
                            <span class="info-value" id="client-phone-display">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Type de service:</span>
                            <span class="info-value" id="service-type-display">-</span>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3><i class="fas fa-route"></i> Itin√©raire Google Maps</h3>
                        <div class="info-item">
                            <span class="info-label">D√©part:</span>
                            <span class="info-value" id="start-address-display">Position GPS</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Destination:</span>
                            <span class="info-value" id="end-address-display">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Distance estim√©e:</span>
                            <span class="info-value" id="estimated-distance">-- km</span>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3><i class="fas fa-clock"></i> Horaires</h3>
                        <div class="info-item">
                            <span class="info-label">D√©but du trajet:</span>
                            <span class="info-value" id="start-time">--:--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Temps √©coul√©:</span>
                            <span class="info-value" id="elapsed-time">00:00:00</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Date:</span>
                            <span class="info-value" id="current-date">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tracking-section hidden" id="tracking-section">
            <h2 class="section-title"><i class="fab fa-google"></i> Navigation avec Google Maps Android</h2>
            
            <div class="map-integration">
                <h3><i class="fas fa-satellite-dish"></i> Int√©gration Google Maps</h3>
                <p>Utilisez l'application Google Maps de votre t√©l√©phone pour une navigation optimale</p>
                
                <div class="map-buttons">
                    <button class="map-btn" id="open-gmaps-navigation">
                        <i class="fab fa-google"></i> Ouvrir Navigation Google Maps
                    </button>
                    <button class="map-btn map-btn-whatsapp" id="share-location-btn">
                        <i class="fab fa-whatsapp"></i> Partager Position
                    </button>
                </div>
            </div>
            
            <div id="gps-status" class="gps-status gps-waiting">
                <i class="fas fa-satellite-dish"></i> En attente de connexion avec Google Maps...
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Distance parcourue</div>
                    <div class="stat-value" id="distance-traveled">0.0 km</div>
                    <div class="stat-label" id="distance-progress">sur 0.0 km</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Vitesse moyenne</div>
                    <div class="stat-value" id="average-speed">0 km/h</div>
                    <div class="stat-label">en temps r√©el</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Temps √©coul√©</div>
                    <div class="stat-value" id="elapsed-time-display">00:00:00</div>
                    <div class="stat-label">depuis le d√©part</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Tarif actuel</div>
                    <div class="stat-value" id="current-fare">0 FCFA</div>
                    <div class="stat-label" id="price-per-km-display">0 FCFA/km</div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn-app btn-primary-app" id="start-btn">
                    <i class="fas fa-play"></i> D√©marrer le suivi
                </button>
                <button class="btn-app btn-warning-app" id="pause-btn" disabled>
                    <i class="fas fa-pause"></i> Pause
                </button>
                <button class="btn-app btn-accent-app" id="end-btn" disabled>
                    <i class="fas fa-stop"></i> Arriver √† destination
                </button>
            </div>
        </div>
        
        <div class="payment-section hidden" id="payment-section">
            <h2 class="section-title"><i class="fas fa-money-bill-wave"></i> Re√ßu de paiement</h2>
            
            <div class="receipt">
                <div class="receipt-title">RECU DE TRANSPORT</div>
                
                <div class="receipt-details">
                    <div>
                        <div class="receipt-item">
                            <span>Chauffeur:</span>
                            <span id="receipt-driver">-</span>
                        </div>
                        <div class="receipt-item">
                            <span>Client:</span>
                            <span id="receipt-client">-</span>
                        </div>
                        <div class="receipt-item">
                            <span>Service:</span>
                            <span id="receipt-service">-</span>
                        </div>
                        <div class="receipt-item">
                            <span>Date:</span>
                            <span id="receipt-date">-</span>
                        </div>
                    </div>
                    
                    <div>
                        <div class="receipt-item">
                            <span>D√©part:</span>
                            <span id="receipt-start">Position GPS</span>
                        </div>
                        <div class="receipt-item">
                            <span>Destination:</span>
                            <span id="receipt-end">-</span>
                        </div>
                        <div class="receipt-item">
                            <span>Distance parcourue:</span>
                            <span id="receipt-distance">0.0 km</span>
                        </div>
                        <div class="receipt-item">
                            <span>Dur√©e:</span>
                            <span id="receipt-duration">00:00:00</span>
                        </div>
                    </div>
                </div>
                
                <div class="receipt-item">
                    <span>Tarif de base:</span>
                    <span id="receipt-base-fare">0 FCFA</span>
                </div>
                <div class="receipt-item">
                    <span>Frais suppl√©mentaires:</span>
                    <span id="receipt-extra-fees">0 FCFA</span>
                </div>
                <div class="receipt-item receipt-total">
                    <span>TOTAL √Ä PAYER:</span>
                    <span id="receipt-total">0 FCFA</span>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn-app btn-success-app" id="payment-received-btn">
                    <i class="fas fa-check-circle"></i> Paiement re√ßu
                </button>
                <button class="btn-app btn-whatsapp-app" id="send-whatsapp-btn">
                    <i class="fab fa-whatsapp"></i> Envoyer par WhatsApp
                </button>
                <button class="btn-app btn-primary-app" id="print-receipt-btn">
                    <i class="fas fa-print"></i> Imprimer le re√ßu
                </button>
                <button class="btn-app btn-accent-app" id="new-trip-btn">
                    <i class="fas fa-plus"></i> Nouveau trajet
                </button>
            </div>
        </div>
        
        <div class="receipts-section hidden" id="receipts-section">
            <h2 class="section-title"><i class="fas fa-receipt"></i> Historique des re√ßus</h2>
            
            <div class="filters">
                <div class="filter-group">
                    <label for="filter-month">Mois</label>
                    <select id="filter-month">
                        <option value="all">Tous les mois</option>
                        <option value="01">Janvier</option>
                        <option value="02">F√©vrier</option>
                        <option value="03">Mars</option>
                        <option value="04">Avril</option>
                        <option value="05">Mai</option>
                        <option value="06">Juin</option>
                        <option value="07">Juillet</option>
                        <option value="08">Ao√ªt</option>
                        <option value="09">Septembre</option>
                        <option value="10">Octobre</option>
                        <option value="11">Novembre</option>
                        <option value="12">D√©cembre</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filter-region">R√©gion</label>
                    <select id="filter-region">
                        <option value="all">Toutes les r√©gions</option>
                        <option value="maritime">R√©gion Maritime</option>
                        <option value="plateaux">R√©gion des Plateaux</option>
                        <option value="centrale">R√©gion Centrale</option>
                        <option value="kara">R√©gion de la Kara</option>
                        <option value="savanes">R√©gion des Savanes</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filter-locality">Localit√©</label>
                    <select id="filter-locality">
                        <option value="all">Toutes les localit√©s</option>
                        <option value="lome">Lom√©</option>
                        <option value="kpalime">Kpalim√©</option>
                        <option value="sokode">Sokod√©</option>
                        <option value="kara">Kara</option>
                        <option value="dapaong">Dapaong</option>
                    </select>
                </div>
            </div>
            
            <div class="receipts-grid" id="receipts-grid">
                <!-- Les re√ßus sauvegard√©s seront affich√©s ici -->
            </div>
        </div>
        
        <div class="history-section hidden" id="history-section">
            <h2 class="section-title"><i class="fas fa-history"></i> Historique du trajet</h2>
            
            <div id="trip-history">
                <!-- L'historique sera g√©n√©r√© dynamiquement -->
            </div>
        </div>
        
        <footer>
            <p>Compteur de trajet ‚Ä¢ TaxiTogo &copy; 2023</p>
            <p>Heure serveur: <span id="server-time">-</span></p>
        </footer>
    </div>

    <script>
        // Base de donn√©es des conducteurs (simul√©e)
        const driversDatabase = {
            "koffi.mensah": {
                id: "koffi.mensah",
                password: "taxi123",
                name: "Koffi Mensah",
                service: "Moto Taxi",
                region: "Lom√©",
                phone: "+22890123456",
                vehicle: "Moto Yamaha 125",
                registration: "TG-123-AB",
                isActive: true
            },
            "ama.djondo": {
                id: "ama.djondo",
                password: "taxi456",
                name: "Ama Djondo",
                service: "Tricycle",
                region: "Kpalim√©",
                phone: "+22890234567",
                vehicle: "Tricycle King",
                registration: "TG-456-CD",
                isActive: true
            },
            "komlan.agbeto": {
                id: "komlan.agbeto",
                password: "taxi789",
                name: "Komlan Agbeto",
                service: "Taxi Bagage",
                region: "Sokod√©",
                phone: "+22890345678",
                vehicle: "Pickup Toyota",
                registration: "TG-789-EF",
                isActive: true
            },
            "afi.gbedema": {
                id: "afi.gbedema",
                password: "taxi000",
                name: "Afi Gbedema",
                service: "Transport Commun",
                region: "Kara",
                phone: "+22890456789",
                vehicle: "Toyota Corolla",
                registration: "TG-000-GH",
                isActive: true
            }
        };

        // Variables globales
        let currentDriver = null;
        let watchId = null;
        let currentPosition = null;
        let previousPosition = null;
        let totalDistance = 0;
        let tripStarted = false;
        let tripPaused = false;
        let startTime = null;
        let timerInterval = null;
        let elapsedSeconds = 0;
        let pricePerKm = 150;
        let extraFees = 200;
        let estimatedDistance = 0;
        let positionsHistory = [];
        let savedReceipts = JSON.parse(localStorage.getItem('savedReceipts')) || [];

        // √âl√©ments DOM
        const loginContainer = document.getElementById('login-container');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const loginAlert = document.getElementById('login-alert');
        const logoutBtn = document.getElementById('logout-btn');
        const togglePasswordBtn = document.getElementById('toggle-password');
        const loginPassword = document.getElementById('login-password');

        // Fonction pour afficher les messages d'alerte
        function showAlert(message, type = 'error') {
            if (!loginAlert) return;
            
            loginAlert.textContent = message;
            loginAlert.className = `alert alert-${type}`;
            loginAlert.classList.remove('hidden');
            
            setTimeout(() => {
                loginAlert.classList.add('hidden');
            }, 5000);
        }

        // Fonction pour basculer la visibilit√© du mot de passe
        if (togglePasswordBtn && loginPassword) {
            togglePasswordBtn.addEventListener('click', function() {
                if (loginPassword.type === 'password') {
                    loginPassword.type = 'text';
                    togglePasswordBtn.innerHTML = '<i class="fas fa-eye-slash"></i>';
                } else {
                    loginPassword.type = 'password';
                    togglePasswordBtn.innerHTML = '<i class="fas fa-eye"></i>';
                }
            });
        }

        // Fonction de connexion
        if (loginForm) {
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const identifiant = document.getElementById('login-identifiant').value.trim();
                const password = document.getElementById('login-password').value;
                
                // Validation
                if (!identifiant || !password) {
                    showAlert('Veuillez remplir tous les champs');
                    return;
                }
                
                // V√©rification dans la base de donn√©es
                if (driversDatabase[identifiant]) {
                    const driver = driversDatabase[identifiant];
                    
                    if (driver.password === password) {
                        if (driver.isActive) {
                            // Connexion r√©ussie
                            currentDriver = driver;
                            initializeApp();
                        } else {
                            showAlert('Votre compte est d√©sactiv√©. Contactez l\'administrateur.');
                        }
                    } else {
                        showAlert('Mot de passe incorrect');
                    }
                } else {
                    showAlert('Identifiant non reconnu');
                }
            });
        }

        // Fonction de d√©connexion
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                currentDriver = null;
                localStorage.removeItem('currentDriver');
                loginContainer.classList.remove('hidden');
                appContainer.classList.add('hidden');
                
                // R√©initialiser le formulaire de connexion
                if (loginForm) loginForm.reset();
                if (loginPassword) {
                    loginPassword.type = 'password';
                    if (togglePasswordBtn) togglePasswordBtn.innerHTML = '<i class="fas fa-eye"></i>';
                }
            });
        }

        // Fonction d'initialisation de l'application apr√®s connexion
        function initializeApp() {
            // Masquer l'√©cran de connexion, afficher l'application
            loginContainer.classList.add('hidden');
            appContainer.classList.remove('hidden');
            
            // Sauvegarder la session
            localStorage.setItem('currentDriver', JSON.stringify(currentDriver));
            
            // Mettre √† jour les informations du conducteur
            document.getElementById('driver-name-display').textContent = currentDriver.name;
            document.getElementById('driver-service-display').textContent = 
                currentDriver.service + ' ‚Ä¢ ' + currentDriver.region + ', Togo';
            
            document.getElementById('driver-name').value = currentDriver.name;
            
            // Ajuster le prix par km selon le type de service
            switch(currentDriver.service) {
                case 'Moto Taxi':
                    pricePerKm = 150;
                    break;
                case 'Tricycle':
                    pricePerKm = 300;
                    break;
                case 'Taxi Bagage':
                    pricePerKm = 500;
                    break;
                case 'Transport Commun':
                    pricePerKm = 200;
                    break;
            }
            
            document.getElementById('price-per-km').value = pricePerKm;
            document.getElementById('service-type').value = currentDriver.service.toLowerCase();
            
            // Initialiser les √©v√©nements de l'application
            initAppEvents();
            
            // Charger les re√ßus sauvegard√©s
            displaySavedReceipts();
            
            // Mettre √† jour la date et l'heure
            updateDate();
            updateServerTime();
            setInterval(updateServerTime, 1000);
        }

        // Fonction pour calculer la distance entre deux points GPS (formule de Haversine)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Rayon de la Terre en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c; // Distance en km
        }

        // Ouvrir Google Maps pour la navigation
        function openGoogleMapsNavigation() {
            const endAddress = document.getElementById('end-address').value;
            if (!endAddress) {
                alert('Veuillez saisir une adresse de destination');
                return;
            }
            
            const encodedEnd = encodeURIComponent(endAddress);
            const gmapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodedEnd}&travelmode=driving&dir_action=navigate`;
            window.open(gmapsUrl, '_blank');
            
            addHistoryEntry('Navigation Google Maps d√©marr√©e vers: ' + endAddress);
        }

        // D√©marrage de la surveillance GPS
        function startGPSTracking() {
            if (navigator.geolocation) {
                const gpsStatus = document.getElementById('gps-status');
                if (gpsStatus) {
                    gpsStatus.textContent = "Connexion GPS en cours...";
                    gpsStatus.className = "gps-status gps-waiting";
                }
                
                const options = {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                };
                
                watchId = navigator.geolocation.watchPosition(
                    updatePosition,
                    handleLocationError,
                    options
                );
                
            } else {
                alert("La g√©olocalisation n'est pas support√©e par votre navigateur.");
            }
        }

        // Mise √† jour de la position
        function updatePosition(position) {
            currentPosition = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                accuracy: position.coords.accuracy,
                timestamp: position.timestamp
            };
            
            // Mettre √† jour l'affichage GPS
            const gpsStatus = document.getElementById('gps-status');
            if (gpsStatus) {
                gpsStatus.textContent = "GPS: Actif (Pr√©cision: ¬±" + Math.round(currentPosition.accuracy) + "m)";
                gpsStatus.className = "gps-status gps-active";
            }
            
            // Mettre √† jour l'adresse de d√©part
            document.getElementById('start-address').value = 
                `GPS: ${currentPosition.lat.toFixed(6)}, ${currentPosition.lng.toFixed(6)}`;
            
            // Stocker la position dans l'historique
            positionsHistory.push({
                ...currentPosition,
                time: new Date().toLocaleTimeString('fr-FR')
            });
            
            // Calculer la distance parcourue depuis la derni√®re position
            if (previousPosition && tripStarted && !tripPaused) {
                const distance = calculateDistance(
                    previousPosition.lat, previousPosition.lng,
                    currentPosition.lat, currentPosition.lng
                );
                
                // Ne prendre en compte que les distances r√©alistes
                if (distance < 1.0) {
                    totalDistance += distance;
                    updateDistanceDisplay();
                }
            }
            
            previousPosition = {...currentPosition};
        }

        // Gestion des erreurs de g√©olocalisation
        function handleLocationError(error) {
            const gpsStatus = document.getElementById('gps-status');
            if (gpsStatus) {
                gpsStatus.textContent = "GPS: Erreur de connexion";
                gpsStatus.className = "gps-status gps-inactive";
            }
            console.error('Erreur GPS:', error);
        }

        // Mise √† jour de l'affichage de la distance
        function updateDistanceDisplay() {
            document.getElementById('distance-traveled').textContent = totalDistance.toFixed(2) + ' km';
            document.getElementById('distance-progress').textContent = 'sur ' + estimatedDistance.toFixed(2) + ' km';
            
            // Calculer le tarif actuel
            const currentFare = Math.round(totalDistance * pricePerKm);
            document.getElementById('current-fare').textContent = currentFare.toLocaleString('fr-FR') + ' FCFA';
            
            // Mettre √† jour la vitesse moyenne
            if (elapsedSeconds > 0) {
                const averageSpeed = (totalDistance / (elapsedSeconds / 3600)).toFixed(1);
                document.getElementById('average-speed').textContent = averageSpeed + ' km/h';
            }
        }

        // Estimation de distance bas√©e sur la destination
        function estimateDistance() {
            const endAddress = document.getElementById('end-address').value.toLowerCase();
            
            if (endAddress.includes('universit√©') || endAddress.includes('universite')) {
                return 7.2;
            } else if (endAddress.includes('a√©roport') || endAddress.includes('aeroport')) {
                return 12.5;
            } else if (endAddress.includes('march√©') || endAddress.includes('marche')) {
                return 3.8;
            } else if (endAddress.includes('stade')) {
                return 5.2;
            } else if (endAddress.includes('gare')) {
                return 4.5;
            } else {
                return 5.0;
            }
        }

        // D√©marrage du trajet
        function startTrip() {
            if (!tripStarted) {
                const clientName = document.getElementById('client-name').value;
                const clientPhone = document.getElementById('client-phone').value;
                const endAddress = document.getElementById('end-address').value;
                
                if (!clientName || !clientPhone || !endAddress) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }
                
                tripStarted = true;
                startTime = new Date();
                document.getElementById('start-time').textContent = startTime.toLocaleTimeString('fr-FR', {hour: '2-digit', minute:'2-digit'});
                
                // Estimer la distance
                estimatedDistance = estimateDistance();
                document.getElementById('estimated-distance').textContent = estimatedDistance.toFixed(2) + ' km';
                document.getElementById('distance-progress').textContent = 'sur ' + estimatedDistance.toFixed(2) + ' km';
                
                // D√©marrer le chronom√®tre
                timerInterval = setInterval(updateTimer, 1000);
                
                // D√©marrer le suivi GPS
                startGPSTracking();
                
                // Mettre √† jour l'interface
                document.getElementById('start-btn').disabled = true;
                document.getElementById('pause-btn').disabled = false;
                document.getElementById('end-btn').disabled = false;
                
                addHistoryEntry('Trajet d√©marr√© avec Google Maps');
                addHistoryEntry('Distance estim√©e: ' + estimatedDistance.toFixed(2) + ' km');
            }
        }

        // Mise √† jour du chronom√®tre
        function updateTimer() {
            if (!tripPaused) {
                elapsedSeconds++;
                const timeString = formatTime(elapsedSeconds);
                document.getElementById('elapsed-time').textContent = timeString;
                document.getElementById('elapsed-time-display').textContent = timeString;
                
                // Mettre √† jour l'affichage toutes les 5 secondes
                if (elapsedSeconds % 5 === 0) {
                    updateDistanceDisplay();
                }
            }
        }

        // Formatage du temps √©coul√©
        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Mettre en pause/reprendre le trajet
        function togglePause() {
            tripPaused = !tripPaused;
            document.getElementById('pause-btn').innerHTML = tripPaused ? 
                '<i class="fas fa-play"></i> Reprendre' : 
                '<i class="fas fa-pause"></i> Pause';
            
            document.getElementById('trip-status').textContent = tripPaused ? 'PAUSE' : 'ACTIF';
            document.getElementById('trip-status').className = tripPaused ? 
                'trip-status status-paused' : 'trip-status status-active';
                
            if (tripPaused) {
                addHistoryEntry('Trajet mis en pause');
            } else {
                addHistoryEntry('Trajet repris');
            }
        }

        // Arriver √† destination et g√©n√©rer le re√ßu
        function arriveAtDestination() {
            if (tripStarted) {
                tripStarted = false;
                clearInterval(timerInterval);
                
                if (watchId) {
                    navigator.geolocation.clearWatch(watchId);
                    watchId = null;
                }
                
                // Mettre √† jour l'interface
                document.getElementById('start-btn').disabled = false;
                document.getElementById('pause-btn').disabled = true;
                document.getElementById('end-btn').disabled = true;
                document.getElementById('trip-status').textContent = 'TERMIN√â';
                document.getElementById('trip-status').className = 'trip-status status-finished';
                
                // S'assurer que la distance est correctement calcul√©e
                if (totalDistance === 0 && positionsHistory.length > 1) {
                    let calculatedDistance = 0;
                    for (let i = 1; i < positionsHistory.length; i++) {
                        const dist = calculateDistance(
                            positionsHistory[i-1].lat, positionsHistory[i-1].lng,
                            positionsHistory[i].lat, positionsHistory[i].lng
                        );
                        if (dist < 1.0) {
                            calculatedDistance += dist;
                        }
                    }
                    totalDistance = calculatedDistance;
                }
                
                // G√©n√©rer le re√ßu
                generateReceipt();
                
                // Afficher la section de paiement
                document.getElementById('payment-section').classList.remove('hidden');
                
                addHistoryEntry('Destination atteinte');
                addHistoryEntry('Distance finale parcourue: ' + totalDistance.toFixed(2) + ' km');
            }
        }

        // G√©n√©rer le re√ßu de paiement
        function generateReceipt() {
            const driverName = document.getElementById('driver-name').value;
            const clientName = document.getElementById('client-name').value;
            const clientPhone = document.getElementById('client-phone').value;
            const serviceType = document.getElementById('service-type').options[document.getElementById('service-type').selectedIndex].text;
            const endAddress = document.getElementById('end-address').value;
            
            // Calculer le tarif final
            const baseFare = Math.round(totalDistance * pricePerKm);
            const totalFare = baseFare + extraFees;
            
            // Mettre √† jour le re√ßu
            document.getElementById('receipt-driver').textContent = driverName;
            document.getElementById('receipt-client').textContent = clientName;
            document.getElementById('receipt-service').textContent = serviceType;
            document.getElementById('receipt-date').textContent = document.getElementById('current-date').textContent;
            document.getElementById('receipt-start').textContent = 'Position GPS';
            document.getElementById('receipt-end').textContent = endAddress;
            document.getElementById('receipt-distance').textContent = totalDistance.toFixed(2) + ' km';
            document.getElementById('receipt-duration').textContent = document.getElementById('elapsed-time').textContent;
            document.getElementById('receipt-base-fare').textContent = baseFare.toLocaleString('fr-FR') + ' FCFA';
            document.getElementById('receipt-extra-fees').textContent = extraFees.toLocaleString('fr-FR') + ' FCFA';
            document.getElementById('receipt-total').textContent = totalFare.toLocaleString('fr-FR') + ' FCFA';
            document.getElementById('price-per-km-display').textContent = pricePerKm + ' FCFA/km';
            
            // Sauvegarder le re√ßu
            saveReceipt({
                id: Date.now(),
                driverId: currentDriver.id,
                driverName,
                clientName,
                clientPhone,
                serviceType,
                startAddress: 'Position GPS',
                endAddress,
                distance: totalDistance,
                duration: document.getElementById('elapsed-time').textContent,
                baseFare,
                extraFees,
                totalFare,
                date: new Date().toISOString().split('T')[0],
                region: getRegionFromAddress(endAddress),
                locality: getLocalityFromAddress(endAddress)
            });
        }

        // Sauvegarder le re√ßu
        function saveReceipt(receipt) {
            savedReceipts.unshift(receipt);
            if (savedReceipts.length > 100) {
                savedReceipts = savedReceipts.slice(0, 100);
            }
            localStorage.setItem('savedReceipts', JSON.stringify(savedReceipts));
            displaySavedReceipts();
        }

        // Afficher les re√ßus sauvegard√©s
        function displaySavedReceipts() {
            const receiptsGrid = document.getElementById('receipts-grid');
            if (!receiptsGrid) return;
            
            receiptsGrid.innerHTML = '';
            
            // Filtrer les re√ßus du conducteur connect√©
            const driverReceipts = savedReceipts.filter(receipt => receipt.driverId === currentDriver.id);
            
            const monthFilter = document.getElementById('filter-month').value || 'all';
            const regionFilter = document.getElementById('filter-region').value || 'all';
            const localityFilter = document.getElementById('filter-locality').value || 'all';
            
            const filteredReceipts = driverReceipts.filter(receipt => {
                const receiptMonth = receipt.date.split('-')[1];
                const matchesMonth = monthFilter === 'all' || receiptMonth === monthFilter;
                const matchesRegion = regionFilter === 'all' || receipt.region === regionFilter;
                const matchesLocality = localityFilter === 'all' || receipt.locality === localityFilter;
                
                return matchesMonth && matchesRegion && matchesLocality;
            });
            
            if (filteredReceipts.length === 0) {
                receiptsGrid.innerHTML = '<p>Aucun re√ßu trouv√© pour les crit√®res s√©lectionn√©s.</p>';
                return;
            }
            
            filteredReceipts.forEach(receipt => {
                const receiptCard = document.createElement('div');
                receiptCard.className = 'receipt-card';
                
                const date = new Date(receipt.date).toLocaleDateString('fr-FR');
                
                receiptCard.innerHTML = `
                    <div class="receipt-card-header">
                        <span class="receipt-card-date">${date}</span>
                        <span class="receipt-card-amount">${receipt.totalFare.toLocaleString('fr-FR')} FCFA</span>
                    </div>
                    <div class="receipt-card-details">
                        <div><strong>Client:</strong> ${receipt.clientName}</div>
                        <div><strong>Service:</strong> ${receipt.serviceType}</div>
                        <div><strong>Trajet:</strong> ${receipt.startAddress} ‚Üí ${receipt.endAddress}</div>
                        <div><strong>Distance:</strong> ${receipt.distance.toFixed(2)} km</div>
                        <div><strong>Dur√©e:</strong> ${receipt.duration}</div>
                    </div>
                `;
                
                receiptsGrid.appendChild(receiptCard);
            });
        }

        // Obtenir la r√©gion depuis l'adresse
        function getRegionFromAddress(address) {
            if (address.includes('Lom√©') || address.includes('An√©ho') || address.includes('Ts√©vi√©')) {
                return 'maritime';
            } else if (address.includes('Kpalim√©') || address.includes('Atakpam√©')) {
                return 'plateaux';
            } else if (address.includes('Sokod√©') || address.includes('Bafilo')) {
                return 'centrale';
            } else if (address.includes('Kara') || address.includes('Niamtougou')) {
                return 'kara';
            } else if (address.includes('Dapaong') || address.includes('Mango')) {
                return 'savanes';
            }
            return 'inconnue';
        }

        // Obtenir la localit√© depuis l'adresse
        function getLocalityFromAddress(address) {
            if (address.includes('Lom√©')) return 'lome';
            if (address.includes('Kpalim√©')) return 'kpalime';
            if (address.includes('Sokod√©')) return 'sokode';
            if (address.includes('Kara')) return 'kara';
            if (address.includes('Dapaong')) return 'dapaong';
            return 'autre';
        }

        // Mise √† jour de la date
        function updateDate() {
            const now = new Date();
            const options = { day: 'numeric', month: 'short', year: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('fr-FR', options);
        }

        // Mise √† jour de l'heure serveur
        function updateServerTime() {
            const now = new Date();
            const serverTimeElement = document.getElementById('server-time');
            if (serverTimeElement) {
                serverTimeElement.textContent = now.toLocaleTimeString('fr-FR');
            }
        }

        // Ajouter une entr√©e √† l'historique
        function addHistoryEntry(action) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('fr-FR');
            
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.innerHTML = `
                <span class="history-time">${timeString}</span>
                <span class="history-action">${action}</span>
            `;
            
            const tripHistory = document.getElementById('trip-history');
            if (tripHistory) {
                tripHistory.prepend(historyItem);
            }
        }

        // Initialisation des √©v√©nements de l'application
        function initAppEvents() {
            // √âv√©nement pour d√©marrer le trajet
            document.getElementById('start-trip-btn').addEventListener('click', function() {
                const clientName = document.getElementById('client-name').value;
                const clientPhone = document.getElementById('client-phone').value;
                const endAddress = document.getElementById('end-address').value;
                
                // Validation
                if (!clientName || !clientPhone || !endAddress) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }
                
                // Mettre √† jour l'affichage
                document.getElementById('client-name-display').textContent = clientName;
                document.getElementById('client-phone-display').textContent = clientPhone;
                document.getElementById('service-type-display').textContent = 
                    document.getElementById('service-type').options[document.getElementById('service-type').selectedIndex].text;
                document.getElementById('end-address-display').textContent = endAddress;
                document.getElementById('price-per-km-display').textContent = pricePerKm + ' FCFA/km';
                
                // Afficher les sections du trajet
                document.getElementById('setup-form').classList.add('hidden');
                document.getElementById('trip-card').classList.remove('hidden');
                document.getElementById('tracking-section').classList.remove('hidden');
                document.getElementById('history-section').classList.remove('hidden');
                
                // Ouvrir Google Maps automatiquement
                setTimeout(openGoogleMapsNavigation, 500);
            });

            // √âv√©nements des boutons de navigation
            document.getElementById('open-gmaps-navigation').addEventListener('click', openGoogleMapsNavigation);
            
            document.getElementById('share-location-btn').addEventListener('click', function() {
                if (currentPosition) {
                    const message = `üìç Ma position actuelle: https://maps.google.com/?q=${currentPosition.lat},${currentPosition.lng}`;
                    const phone = document.getElementById('client-phone').value.replace(/\D/g, '');
                    const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
                    window.open(whatsappUrl, '_blank');
                    addHistoryEntry('Position partag√©e avec le client via WhatsApp');
                } else {
                    alert("Position non disponible. Attendez que le GPS se connecte.");
                }
            });

            // √âv√©nements des contr√¥les de trajet
            document.getElementById('start-btn').addEventListener('click', startTrip);
            document.getElementById('pause-btn').addEventListener('click', togglePause);
            document.getElementById('end-btn').addEventListener('click', arriveAtDestination);

            // √âv√©nements de paiement
            document.getElementById('payment-received-btn').addEventListener('click', function() {
                const totalFare = document.getElementById('receipt-total').textContent;
                alert('Paiement de ' + totalFare + ' confirm√©! Merci pour votre service.');
                addHistoryEntry('Paiement re√ßu et confirm√©');
                document.getElementById('receipts-section').classList.remove('hidden');
            });

            document.getElementById('send-whatsapp-btn').addEventListener('click', function() {
                const clientPhone = document.getElementById('client-phone').value.replace(/\D/g, '');
                const totalFare = document.getElementById('receipt-total').textContent;
                const clientName = document.getElementById('client-name').value;
                const distance = document.getElementById('receipt-distance').textContent;
                const duration = document.getElementById('receipt-duration').textContent;
                
                const message = `Bonjour ${clientName},\n\nVotre re√ßu de transport :\n‚Ä¢ Distance: ${distance}\n‚Ä¢ Dur√©e: ${duration}\n‚Ä¢ Montant: ${totalFare}\n\nMerci pour votre confiance! üöï`;
                const whatsappUrl = `https://wa.me/${clientPhone}?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                addHistoryEntry('Re√ßu envoy√© par WhatsApp au client');
            });

            document.getElementById('new-trip-btn').addEventListener('click', function() {
                // R√©initialiser les variables
                totalDistance = 0;
                tripStarted = false;
                tripPaused = false;
                elapsedSeconds = 0;
                positionsHistory = [];
                currentPosition = null;
                previousPosition = null;
                estimatedDistance = 0;
                
                if (timerInterval) clearInterval(timerInterval);
                if (watchId) {
                    navigator.geolocation.clearWatch(watchId);
                    watchId = null;
                }
                
                // R√©initialiser l'interface
                document.getElementById('distance-traveled').textContent = '0.0 km';
                document.getElementById('current-fare').textContent = '0 FCFA';
                document.getElementById('elapsed-time').textContent = '00:00:00';
                document.getElementById('elapsed-time-display').textContent = '00:00:00';
                document.getElementById('average-speed').textContent = '0 km/h';
                document.getElementById('estimated-distance').textContent = '-- km';
                document.getElementById('distance-progress').textContent = 'sur 0.0 km';
                document.getElementById('start-address').value = 'Position GPS';
                
                // Cacher les sections, afficher le formulaire
                document.getElementById('trip-card').classList.add('hidden');
                document.getElementById('tracking-section').classList.add('hidden');
                document.getElementById('payment-section').classList.add('hidden');
                document.getElementById('receipts-section').classList.add('hidden');
                document.getElementById('history-section').classList.add('hidden');
                document.getElementById('setup-form').classList.remove('hidden');
                
                addHistoryEntry('Nouveau trajet pr√©par√©');
            });

            // √âv√©nements des filtres
            document.getElementById('filter-month').addEventListener('change', displaySavedReceipts);
            document.getElementById('filter-region').addEventListener('change', displaySavedReceipts);
            document.getElementById('filter-locality').addEventListener('change', displaySavedReceipts);

            // √âv√©nement pour le bouton d'impression
            document.getElementById('print-receipt-btn').addEventListener('click', function() {
                window.print();
            });
        }

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            // V√©rifier s'il y a une session active
            const savedDriver = localStorage.getItem('currentDriver');
            if (savedDriver) {
                try {
                    const driver = JSON.parse(savedDriver);
                    if (driversDatabase[driver.id] && driversDatabase[driver.id].isActive) {
                        currentDriver = driver;
                        initializeApp();
                    }
                } catch (e) {
                    console.error('Erreur de parsing de la session:', e);
                    localStorage.removeItem('currentDriver');
                }
            }
        });
    </script>
</body>
</html>
